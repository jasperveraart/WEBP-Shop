@using Microsoft.AspNetCore.Components.Forms
@using System.ComponentModel.DataAnnotations

<style>
    .signup-modal-backdrop {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1050;
    }

    .signup-modal {
        background-color: white;
        padding: 2rem;
        border-radius: 0.5rem;
        box-shadow: 0 0.5rem 1rem rgba(0,0,0,0.3);
        max-width: 400px;
        width: 100%;
    }

    .form-check {
        margin-bottom: 0.5rem;
    }
</style>

@if (IsVisible)
{
    <div class="signup-modal-backdrop" @onclick="Close">
        <div class="signup-modal rounded-lg" @onclick:stopPropagation>
            <div class="modal-header d-flex justify-content-between align-items-center mb-3">
                <h2 class="mb-0">Sign Up</h2>
                <button class="btn-close" @onclick="Close"></button>
            </div>
            <EditForm Model="formModel" OnValidSubmit="SubmitForm">
                <DataAnnotationsValidator />
                <ValidationSummary />

                <InputText placeholder="Full Name" @bind-Value="formModel.Name" class="form-control mb-2" />
                <InputText placeholder="Email" @bind-Value="formModel.Email" class="form-control mb-2" />
                <InputText type="password" placeholder="Password" @bind-Value="formModel.Password" class="form-control mb-2" />
                <InputText type="password" placeholder="Confirm Password" @bind-Value="formModel.ConfirmPassword" class="form-control mb-2" />

                <InputRadioGroup @bind-Value="formModel.Role">
                    <div class="d-flex justify-content-center">
                        <div class="form-check me-2">
                            <InputRadio Value="Roles.Customer" id="roleCustomer" class="form-check-input"/>
                            <label for="roleCustomer" class="form-check-label">Customer</label>
                        </div>
                        <div class="form-check">
                            <InputRadio Value="Roles.Supplier" id="roleSupplier" class="form-check-input"/>
                            <label for="roleSupplier" class="form-check-label">Supplier</label>
                        </div>
                    </div>
                </InputRadioGroup>

                @if (formModel.Role == Roles.Customer)
                {
                    <InputText placeholder="Shipping Address" @bind-Value="formModel.ShoppingAddress" class="form-control mb-2" />
                }

                <button type="submit" class="btn btn-primary mt-3 w-100">Sign Up</button>
            </EditForm>
        </div>
    </div>
}

@code {
    [Parameter] public bool IsVisible { get; set; }
    [Parameter] public EventCallback<bool> IsVisibleChanged { get; set; }

    
    private async Task Close()
    {
        
        IsVisible = false;
        Console.WriteLine("ciao");
        await IsVisibleChanged.InvokeAsync(IsVisible);
    }
    
    private SignUpModel formModel = new();

    private async Task SubmitForm()
    {
        if (formModel.Password != formModel.ConfirmPassword)
        {
            Console.WriteLine("Passwords do not match");
            return;
        }

        Console.WriteLine($"SignUp: {formModel.Name}, {formModel.Email}, Role: {formModel.Role}");

        if (formModel.Role == Roles.Customer)
            Console.WriteLine($"Shopping Address: {formModel.ShoppingAddress}");

        await Task.CompletedTask;
    }

    private class SignUpModel
    {
        [Required] public string Name { get; set; } = "";
        [Required, EmailAddress] public string Email { get; set; } = "";
        [Required] public string Password { get; set; } = "";
        [Required] public string ConfirmPassword { get; set; } = "";
        public Roles Role { get; set; } = Roles.Customer;

        // Nuovo campo solo per Customer
        public string ShoppingAddress { get; set; } = "";
    }

    private enum Roles
    {
        Customer,
        Supplier
    }
    
}
