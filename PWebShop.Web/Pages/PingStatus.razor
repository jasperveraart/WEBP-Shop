@page "/ping"
@using System.Net.Http
@using System.Net.Http.Json
@inject HttpClient Http

<h3>API ping</h3>

<button class="btn btn-primary" @onclick="TestApiAsync">Test API verbinding</button>

@if (_statusMessage is not null)
{
    <div class="mt-3">
        <p><strong>Status:</strong> @_statusMessage</p>
        @if (!string.IsNullOrWhiteSpace(_body))
        {
            <pre>@_body</pre>
        }
    </div>
}

@code {
    private string? _statusMessage;
    private string? _body;

    private async Task TestApiAsync()
    {
        _statusMessage = "Bezig...";
        _body = null;

        try
        {
            // HttpClient is al op http://localhost:5091 gezet in Program cs
            var response = await Http.GetAsync("api/ping");
            _statusMessage = $"{(int)response.StatusCode} {response.ReasonPhrase}";
            _body = await response.Content.ReadAsStringAsync();
        }
        catch (HttpRequestException ex)
        {
            _statusMessage = "Fout bij verbinden";
            _body = ex.Message;
        }
        catch (TaskCanceledException)
        {
            _statusMessage = "Timeout of geannuleerd";
            _body = string.Empty;
        }
    }
}